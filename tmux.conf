#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~Miscellaneous~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#Stop window being constrained in size, where possible:
setw -g aggressive-resize on

# Window index base 1
set -g base-index 1
# large history
set-option -g history-limit 100000

# automatically set window title
set -g automatic-rename

# make tmux know to pass on C_UP ETC
set-window-option -g xterm-keys on
set -g xterm-keys on
set -g default-terminal "screen"

# Automatically rename tabs when command is run
setw -g automatic-rename

# Renumber windows
set -g renumber-windows on

# Rate limiting to stop terminal being overwhelmed
setw -g c0-change-interval 100
setw -g c0-change-trigger 250

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~Keyboard shortcuts~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# don't cycle through pane prearrangements
# this always messes up my panes
unbind " "

# kill a window with K or k 
unbind K
unbind k
bind K "kill-window"
bind k confirm-before "kill-window"

# prefix change to C-a
unbind C-b
set -g prefix C-a
bind C-b "send-prefix"

# <prefix>C-a for last active pane
bind C-a last-pane

# Don't need a gap between commands
set -s escape-time 0

# Re-read this file when i do <prefix>r
bind r source-file ~/.tmux.conf \; display-message ".tmux.conf sourced."

#C-q to enter copy-mode (no prefix!)
unbind [
bind -n C-q copy-mode

#Copy tmux clipboard to system by pressing <prefix>C (doesnt work on mac)
bind-key C run-shell "tmux show-buffer | xsel -i -b"

#[ and ] to go up to the last command in copy-mode (doesn't work - no send-keys in copy mode)
#unbind -t vi-copy '['
#bind -t vi-copy [ 'search-backward' \;

#Swap ; and : from vi default, as in (my) Vim
bind -t vi-copy : jump-again
bind -t vi-copy \; goto-line

#Put pwd in tmux paste buffer
unbind d
bind d send-keys " pwd"\; send-keys Enter\; run-shell "sleep 0.05"\; copy-mode\; send-keys kk^Y

# <prefix>c new window
bind c neww -c "#{pane_current_path}"

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
#~~~~~~~~~~~~~~~~~~~Colour scheme~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

set -g default-terminal "screen-256color"

# default statusbar colors
set-option -g status-bg colour235 #base02
set-option -g status-fg colour136 #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg colour252
set-window-option -g window-status-bg default
set-window-option -g window-status-attr default

# active window title colors
set-window-option -g window-status-current-fg colour166 #orange
set-window-option -g window-status-current-bg default
set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg colour124 #base02
set-option -g pane-active-border-fg colour166 #base01

# message text
set-option -g message-bg colour235 #base02
set-option -g message-fg colour166 #orange

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~Vim-like behaviour~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# split windows like vim
# vim's definition of a horizontal/vertical split is reversed from tmux's
bind s split-window -v -c '#{pane_current_path}'
bind v split-window -h -c "#{pane_current_path}"

# unbind old vim-like move around panes mappings to learn alt cmd
unbind h
unbind j
unbind k
unbind l
unbind 1
unbind 2
unbind 3
unbind 4
unbind 5
unbind 6
unbind 7
unbind 8
unbind 9

# or with <alt>-hjkl with no prefix!
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# alt-number for window-changing!
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# resize panes like vim
bind -r < resize-pane -L 5
bind -r > resize-pane -R 5
bind -r - resize-pane -D 5
bind -r + resize-pane -U 5

# bind ; to command-prompt like (my) vim
bind \; command-prompt

# bind vi key-mapping
set -g status-keys vi
# vi-style controls for copy mode
setw -g mode-keys vi

#vim-like copy and paste:
unbind p
bind p paste-buffer
bind -t vi-copy 'v' begin-selection
bind -t vi-copy 'y' copy-selection
bind -t vi-copy 'Y' copy-end-of-line

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~tmux powerline~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

set-option -g status on
set-option -g status-interval 1
set-option -g status-utf8 on
set-option -g status-justify "centre"
set-option -g status-left-length 60
set-option -g status-right-length 90
set-option -g status-left "#(~/scripts/tmux-powerline/status-left.sh)"
set-option -g status-right "#(~/scripts/tmux-powerline/status-right.sh)"
