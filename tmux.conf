#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~Miscellaneous~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#Stop window being constrained in size, where possible:
setw -g aggressive-resize on

# Window index base 1
set -g base-index 1
# large history
set-option -g history-limit 100000
# set -g visual-bell on
# automatically set window title
set -g automatic-rename

# make tmux know to pass on C_UP ETC
set-window-option -g xterm-keys on
set -g xterm-keys on
set -g default-terminal "screen"

# Automatically rename tabs when command is run
setw -g automatic-rename

# Renumber windows
set -g renumber-windows on

# Rate limiting to stop terminal being overwhelmed
setw -g c0-change-interval 100
setw -g c0-change-trigger 250

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~Keyboard shortcuts~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# kill a window with K or k 
unbind K
unbind k
bind K "kill-window"
bind k confirm-before "kill-window"

# prefix change to C-a
unbind C-b
set -g prefix C-a

# <prefix>C-a for last active window
bind C-a last-pane

# Don't need a gap between commands
set -s escape-time 0

# Re-read this file when i do <prefix>r
bind r source-file ~/.tmux.conf \; display-message ".tmux.conf sourced."

#C-q to enter copy-mode (no prefix!)
unbind [
bind -n C-q copy-mode

#Copy tmux clipboard to system by pressing <prefix>C (doesnt work on mac)
bind-key C run-shell "tmux show-buffer | xsel -i -b"

#[ and ] to go up to the last command in copy-mode (doesn't work - no send-keys in copy mode)
#unbind -t vi-copy '['
#bind -t vi-copy [ 'search-backward' \;

#Swap ; and : from vi default, as in (my) Vim
bind -t vi-copy : jump-again
bind -t vi-copy \; goto-line

#Put pwd in tmux paste buffer
unbind d

# <prefix>d puts pwd on tmux's copypaste buffer
bind d send-keys pwd\; send-keys Enter\; run-shell "sleep 0.05"\; copy-mode\; send-keys kk^Y

# <prefix>c new window
bind c neww -c "#{pane_current_path}"

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
#~~~~~~~~~~~~~~~~~~~Colour scheme~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# default statusbar colors
set-option -g status-bg colour235 #base02
set-option -g status-fg colour136 #yellow
set-option -g status-attr default

# default window title colors
set-window-option -g window-status-fg colour244
set-window-option -g window-status-bg default
set-window-option -g window-status-attr dim

# active window title colors
set-window-option -g window-status-current-fg colour166 #orange
set-window-option -g window-status-current-bg default
set-window-option -g window-status-current-attr bright

# pane border
set-option -g pane-border-fg colour124 #base02
set-option -g pane-active-border-fg colour166 #base01

# message text
set-option -g message-bg colour235 #base02
set-option -g message-fg colour166 #orange

# pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# clock
set-window-option -g clock-mode-colour colour64 #green

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~Vim-like behaviour~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# split windows like vim
# vim's definition of a horizontal/vertical split is reversed from tmux's
bind s split-window -v -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"

# move around panes with C-hjkl
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# resize panes like vim
# feel free to change the "1" to however many lines you want to resize by, only
# one at a time can be slow
bind < resize-pane -L 10
bind > resize-pane -R 10
bind - resize-pane -D 10
bind + resize-pane -U 10

# bind ; to command-prompt like (my) vim
bind \; command-prompt

# bind vi key-mapping
set -g status-keys vi
# vi-style controls for copy mode
setw -g mode-keys vi

#vim-like copy and paste:
unbind p
bind p paste-buffer
bind -t vi-copy 'v' begin-selection
bind -t vi-copy 'y' copy-selection
bind -t vi-copy 'Y' copy-end-of-line

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~tmux powerline~~~~~~~~~~~~~~~~~~~~~~
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

set-option -g status on
set-option -g status-interval 1
set-option -g status-utf8 on
set-option -g status-justify "centre"
set-option -g status-left-length 60
set-option -g status-right-length 90
set-option -g status-left "#(~/scripts/tmux-powerline/status-left.sh)"
set-option -g status-right "#(~/scripts/tmux-powerline/status-right.sh)"
